#!/usr/bin/env node

var sys = require('sys');
var server = require('../src').server;

var arg, argv = process.argv.slice(2), match, val,
    options = {
        port: 8080
    };

while (arg = argv.shift()) {
    if (match = arg.match(/^--?(.+)/)) {
        arg = match[1];
        arg = { 'p' : 'port' }[arg] || arg;

        if (arg in options) {
            val = argv[0][0] !== '-' ? argv.shift() : true;
            options[arg] = /^[0-9]+$/.test(val) ? parseInt(val) : val;
        }
    }
}

server.listen(options.port);

sys.puts("Listening on 127.0.0.1:" + options.port);

function error(topic, message) {
    sys.error("server: ! `" + topic + "`" + " " + message);
    process.exit(1);
}

